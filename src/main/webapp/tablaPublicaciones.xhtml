<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"

      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Facelet Title</title>
    </h:head>
    <h:body>
        <ui:composition template="app.xhtml">
            <ui:define name="contenido">


                <h:form id="form" class="p-mx-6">

                    <div class="p-d-flex p-jc-between p-ai-center">
                        <h1 class="secondary titulo-principal">Tabla publicación</h1>
                        <div>

                            <p:outputLabel for="@next" value="Mostrar" style="margin-right: 2em"/>
                            <p:selectOneMenu id="option" value="#{tablaPublicaciones.mostrar}">
                                <p:ajax listener="#{tablaPublicaciones.onCambioMostrar()}" update=":form:dataPublicaciones"/>
                                <f:selectItem itemLabel="Todo" itemValue="todo"/>
                                <f:selectItem itemLabel="Mis publicaciones" itemValue="mispublicaciones"/>
                            </p:selectOneMenu>
                        </div>

                    </div>
                    
                    
                    <div class="p-grid ui-fluid">
                        <div class="p-col-2">
                            <p:selectOneMenu value="#{tablaPublicaciones.tipo}">
                                <f:selectItem itemLabel="ID" itemValue="id"/>
                                <f:selectItem itemLabel="Titulo" itemValue="titulo"/>
                                <f:selectItem itemLabel="Año" itemValue="anio"/>
                                <f:selectItem itemLabel="Fuente de publicación" itemValue="fuente"/>
                                <f:selectItem itemLabel="Autor" itemValue="autor"/>
                                <f:selectItem itemLabel="Hallazgo" itemValue="hallazgo"/>
                            </p:selectOneMenu>
                        </div>
                        <div class="p-col-8">
                            <p:inputText value="#{tablaPublicaciones.texto}"/>
                        </div>

                        <div class="p-col-2">
                            <p:commandButton 
                                class="bgprimary border-primary" 
                                update="dataPublicaciones"
                                value="Buscar" 
                                action="#{tablaPublicaciones.buscar()}">
                            </p:commandButton>

                        </div>
                    </div>

                    <p:dataTable size="small" 
                                 value="#{tablaPublicaciones.publicaciones}" 
                                 rows="5" 
                                 paginator="true" 
                                 multiViewState="true" selectionMode="single"
                                 var="pub" id="dataPublicaciones" rowKey="#{pub.idPublicacion}" selection="#{tablaPublicaciones.pubSelect}"

                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros"
                                 rowsPerPageTemplate="5,10,{ShowAll|'Todo'}">
                        
                        <p:ajax event="rowSelect" update=":form:modalinfo" onsuccess="PF('dlginfo').show()" />

                        <p:column sortBy="#{pub.titulo}" headerText="Título">
                            <h:outputText value="#{pub.titulo}" />
                        </p:column>


                        <p:column sortBy="#{pub.autor}" headerText="Autor">
                            <h:outputText value="#{pub.autor}" />
                        </p:column>
                        <p:column sortBy="#{pub.anio}" headerText="Año">
                            <h:outputText value="#{pub.anio}" />
                        </p:column>

                        <p:column sortBy="#{pub.tipoPublicacion}" headerText="Tipo de publicación">
                            <h:outputText value="#{pub.tipoPublicacion}" />
                        </p:column>
                        <p:column sortBy="#{pub.fuente}" headerText="Fuente">
                            <h:outputText value="#{pub.fuente}" />
                        </p:column>

                        <p:column sortBy="#{pub.citasRecibidas}" headerText="Citas">
                            <h:outputText value="#{pub.citasRecibidas}" />
                        </p:column>
                        
                        <p:column sortBy="#{pub.aprobado}" headerText="Aprobadas">
                            <h:outputText value="#{pub.aprobado}" />
                        </p:column>


                    </p:dataTable>

                    <p:dialog header="Información de la publicación" widgetVar="dlginfo" minHeight="40" width="900" showEffect="fade" modal="true">
                        <h:panelGroup id="modalinfo">

                            <p:scrollPanel style="height:400px; border: none;">


                                <h1 class="p-m-0 secondary titulo">Titulo: #{tablaPublicaciones.pubSelect.titulo}</h1>
                                <p class=""> <strong>ID:</strong>  #{tablaPublicaciones.pubSelect.idPublicacion}</p>
                                <p class=""> <strong>Autor:</strong>  #{tablaPublicaciones.pubSelect} · <strong>Año:</strong> #{tablaPublicaciones.pubSelect.anio} </p>
                                <p class=""> <strong>Tipo de publicación:</strong>  #{tablaPublicaciones.pubSelect.tipoPublicacion} · <strong>Fuente:</strong> #{tablaPublicaciones.pubSelect.fuente} </p>
                                <p class=""> <strong>Cantidad de citas recividas:</strong>  #{tablaPublicaciones.pubSelect.citasRecibidas}</p>
                                <p class=""> <strong>Resumen:</strong> #{tablaPublicaciones.pubSelect.resumen}</p>
                                <h3>Hallazgo</h3>
                                <p><strong>Objetivo: </strong>#{tablaPublicaciones.hallazgo.objetivo}</p>
                                
                                <h3>Autores</h3>
                                
                                <p:dataTable id="autores" var="autor" value="#{tablaPublicaciones.autores}">
                                    <p:column headerText="Nombre">
                                        <h:outputText value="#{autor.nombre}" />
                                    </p:column>
                                </p:dataTable>
                                
                                <h3>Datos</h3>
                                
                                <p:dataTable id="datos" var="dato" value="#{tablaPublicaciones.datos}">
                                    <p:column headerText="Titulo">
                                        <h:outputText value="#{dato.titulo}" />
                                    </p:column>
                                    <p:column headerText="Descripción">
                                        <h:outputText value="#{dato.descripcion}" />
                                    </p:column>
                                </p:dataTable>
                                
                            </p:scrollPanel>

                        </h:panelGroup>
                    </p:dialog>

                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

